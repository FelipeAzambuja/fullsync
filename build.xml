<?xml version="1.0"?>
<project name="FullSync" default="run" basedir="." >
	
	<property file="build.properties"/>
	
	<!-- Project Properties -->
	<property name="name" 				value="FullSync"/>
	<property name="project"			value="FullSync"/>
	<property name="version"			value="0.7.1"/>
	<property name="final.name"			value="${project}-${version}"/>
	<property name="final-src.name"		value="${project}-${version}-src"/>

	<property name="source.dir"			value="${basedir}/source" />
	<property name="res.dir"			value="${basedir}/resources" />
	<property name="classes.dir"		value="${basedir}/classes" />
	<property name="build.dir"			value="${basedir}/build" />
	<property name="dist.dir"			value="${basedir}/build" />

	<property name="debug" 				value="on" />
	
	<fileset id="dependentJars" dir="E:/Java/lib">
		<include name="j2ssh-core.jar"/>
		<include name="jakarta-oro-2.0.7.jar"/>		
		<include name="commons-betwixt-1.0-alpha-1.jar"/>
		<include name="commons-logging.jar"/>
		<include name="commons-io.jar"/>
		<include name="commons-beanutils.jar"/>
		<include name="commons-collections.jar"/>
		<include name="commons-net-1.2.2.jar"/>
		<include name="commons-digester-1.5.jar"/>
		<include name="xercesImpl.jar"/>
		<include name="xml-apis.jar"/>
		<include name="swt.jar"/>
		<include name="log4j-1.2.8.jar"/>
	</fileset>
	<path id="classpath">
		<fileset refid="dependentJars"/>
		<pathelement location="${classes.dir}" />
	</path>

	<target name="detect" description="Display configuration and conditional compilation flags">
		<echo message="--- ${name} ${version} Build ---"/>
	</target>

	<target name="clean" description="cleans project files" >
		<delete dir="${build.dir}" /> 
		<delete dir="${dist.dir}" /> 		
	</target>

	<target name="compile">
		<javac debug="${debug}" srcdir="${source.dir}" destdir="${classes.dir}" classpathref="classpath"/>
	</target>
	
	<target name="javadoc">
		<mkdir dir="${build.dir}/doc/api"/>
		<javadoc destdir="${build.dir}/doc/api" classpathref="classpath">
			<packageset dir="${source.dir}">
				<include name="**"/>
			</packageset>
		</javadoc>
	</target>
	
	<target name="jar" depends="compile">
		<mkdir dir="${build.dir}/lib"/>
		<jar destfile="${build.dir}/lib/fullsync.jar">
			<fileset dir="${classes.dir}">
				<include name="**/*"/>
			</fileset>
		</jar>
	</target>
	
	<target name="copy-libs">
		<copy todir="${build.dir}/lib">
			<fileset refid="dependentJars"></fileset>
		</copy>
	</target>

	<target name="installer" description="Create Windows installer" depends="jar">
		<echo message="Builds a Windows installer based on Nullsoft Installer"/>
		<echo message="NSIS must be installed in the default directory"/>
		<copy file="${nsis.installoptions.dll}" todir="${dist.dir}"/>
		<copy file="${nsis.nsexec.dll}" todir="${dist.dir}"/>
		<filter token="VERSION" value="${version}"/>
		<copy todir="${dist.dir}/lib">
			<fileset refid="dependentJars" />
		</copy>
		<copy file="${res.dir}/fullsync.nsi" tofile="${dist.dir}/fullsync.nsi" filtering="true"/>
		<exec dir="${dist.dir}" executable="${nsis.exe}">
			<arg value="/DNSISDIR=${nsis.home}"/>
			<arg value="fullsync.nsi"/>
		</exec>
		<!--<move file="${tomcat.dist}/fullsync-installer.exe" tofile="${tomcat.release}/v${version}/bin/${final.name}.exe"/>-->
	</target>

	<target name="build" depends="detect, copy-libs, jar, javadoc">
	</target>
	
	<target name="run" depends="compile">
		<java classname="net.sourceforge.fullsync.FullSync" classpathref="classpath" />
	</target>
</project>
